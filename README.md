# Проектирование интернет-сервиса

Задание:
Спроектировать высоконагруженную систему (достаточно MVP), доказать реализуемость.

## 1.Тема 
Сервис «Афиша», где можно узнать о событиях в городе и купить билеты в кино и на мероприятие

www.afisha.ru является частью компании Rambler & Co.

## 2. Возможные диапазоны нагрузок подобного проекта

Статистика сервиса Афиша за 2019 год насчитывает следующее количество посетителей:

месяц 11 685 300
день 475 134
среднее время 2,5 минуты

## 3. Планируемая нагрузка как 30% доля рынка в России

Так как средний пользователь сервиса находится по 2,5 минуты  в день, а среднее количество пользователей на сервисе за день состовляет порядка 375 тысяч. Из этого можно сделать вывод, что:

Пользователь, сделает около 5 запросов к сервису

Суммарный объем страницы составляет ~ 10 Мб (текст+картинки+стили) 

10 Мб * 5(запросов) = 50 Мб на одного пользователя

50 Мб * 475134(пользователя) = 23 756 700 Мб ~ 23 199,9Гб ~ 23Тб в сутки ~ 1 Тб/час

С учетом того, что дневной пик = 2,5 * (среднюю нагрузку) имеем:

475134 / 24 * 2,5 ~ 49 500 человека в час

Максимальная нагрузка в дневной пик = 10(Мб) * 49500(человек/час) ~ 494 931 МБ = 483,33 ТБайт/час

## 4. Логическая схема базы данных (без выбора СУБД) 
![Схема](https://user-images.githubusercontent.com/18511365/69158664-d67df400-0af7-11ea-84aa-c4fab1378851.jpg)

## 5. Физическая система хранения (конкретные СУБД, шардинг, расчет нагрузки, обоснование реализуемости на основе результатов нагрузочного тестирования)

СУБД PostgreSQL хранение данных объявлений и пользователей
++ удобно для продакшена
++ возможна репликация, шардирование
++ много документации
++ постоянная эксплуатация продукта

NoSQL Redis (key-value) хранилище для хранения сессий пользователей
++ быстрый доступ (около 20мс)
++ возможность самоочищения значений по Expires

Необходимая конфигурация: 
2 ТБ данных SQL на SSD-дисках
На каждом сервере установлено два SSD-накопителя по 320 ГБ в RAID 1
Соотношение read-write 40:60
На серверах БД средняя нагрузка на ЦП состаит 10%
2 сервера для распределения нагрузки (load balancers), 1 активный, установлен Proxy
4 активных узла БД, установлена PostgreSQL
2 сервера с поисковым движком ElasticSearch
2 машины с распределённым кэшем под Redis

## 6.Выбор прочих технологий: языки программирования, фреймфорки, протоколы взаимодействия, веб-сервера и т.д.
Языки программирования:

Для реализации сервиса новостей афиши необходимо использовать языки, которые используют многопоточность. Для быстрого старта многопоточность "из коробки". Такие как Golang. Также он является современным трендом построения портала на микросервисной архитектуре

Для тестирования сервиса: Python, с использованием тестовых библиотек.


